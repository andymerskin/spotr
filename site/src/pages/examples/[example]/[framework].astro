---
import Layout from '../../../layouts/Layout.astro';
import Sidebar from '../../../components/Sidebar.astro';
import FrameworkTabs from '../../../components/FrameworkTabs.astro';
import StackBlitzEmbed from '../../../components/StackBlitzEmbed.astro';
import { examples, frameworks } from '../../../data/examples';
import { marked } from 'marked';

export function getStaticPaths() {
  const paths: Array<{ params: { example: string; framework: string } }> = [];
  for (const ex of examples) {
    for (const fw of frameworks) {
      paths.push({
        params: {
          example: ex.slug,
          framework: fw.id,
        },
      });
    }
  }
  return paths;
}

const { example, framework } = Astro.params;

// Validate framework param, fallback to 'react' if invalid
const validFrameworkIds: string[] = frameworks.map((f) => f.id);
const validFramework: 'react' | 'vue' | 'svelte' | 'solid' | 'preact' =
  framework &&
  typeof framework === 'string' &&
  validFrameworkIds.includes(framework)
    ? (framework as 'react' | 'vue' | 'svelte' | 'solid' | 'preact')
    : 'react';

const validExample = examples.find((e) => e.slug === example) ?? examples[0];
const exampleSlug = example ?? validExample.slug;
const exampleTitle = validExample.title;
const exampleDescription = validExample.description;
const descriptionHtml = exampleDescription
  ? marked.parse(exampleDescription)
  : '';
---

<Layout title={exampleTitle} description={exampleDescription}>
  <div class="flex min-h-screen bg-neutral-900">
    <Sidebar currentExample={exampleSlug} />
    <main class="ml-60 flex-1 p-8">
      <h1 class="text-2xl font-bold mb-4 text-neutral-100">{exampleTitle}</h1>
      {
        descriptionHtml && (
          <div
            class="description-prose text-neutral-400 mb-4"
            set:html={descriptionHtml}
          />
        )
      }
      <FrameworkTabs currentFramework={validFramework} example={exampleSlug} />
      <StackBlitzEmbed framework={validFramework} example={exampleSlug} />
    </main>
  </div>
</Layout>
